{% extends 'partials/base.html.twig' %}

{% block content %}

<div class="calendar-container clear-user-agent-styles">

    {% set prevYearUrl = page.url ~ '/year:' ~ calendar.prevYear|date('Y') ~ '/month:' ~ calendar.prevYear|date('m') %}
    {% set nextYearUrl = page.url ~ '/year:' ~ calendar.nextYear|date('Y') ~ '/month:' ~ calendar.nextYear|date('m') %}
    {% set prevMonthUrl = page.url ~ '/year:' ~ calendar.prev.date|date('Y') ~ '/month:' ~ calendar.prev.date|date('m') %}
    {% set nextMonthUrl = page.url ~ '/year:' ~ calendar.next.date|date('Y') ~ '/month:' ~ calendar.next.date|date('m') %}

    <section class="calendar-table">

        <table class="calendar">
            <thead>
                <tr class="controls-container">
                    <th colspan="1">
                        <a href="{{ prevMonthUrl }}" class="calendar-control calendar-hide">{{ 'MONTHS_OF_THE_YEAR'|ta(calendar.prev.date|date('n') - 1) ~ calendar.prev.date|date(' Y') }}</a>
                    </th>
                    <th colspan="5" class="controls">
                        <a href="{{ prevYearUrl }}" class="calendar-button calendar-control">&laquo;</a>
                        <a href="{{ prevMonthUrl }}" class="calendar-button calendar-control">&lsaquo;</a>
                        <span class="month-title">{{ 'MONTHS_OF_THE_YEAR'|ta(calendar.date|date('n') - 1) ~ calendar.date|date(' Y') }}</span>
                        <a href="{{ nextMonthUrl }}" class="calendar-button calendar-control">&rsaquo;</a>
                        <a href="{{ nextYearUrl }}" class="calendar-button calendar-control">&raquo;</a>
                    </th>
                    <th colspan="1">
                        <a href="{{ nextMonthUrl }}" class="calendar-control calendar-hide">{{ 'MONTHS_OF_THE_YEAR'|ta(calendar.next.date|date('n') - 1) ~ calendar.next.date|date(' Y') }}</a>
                    </th>
                </tr>
                <tr class="headings">
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(6) }}</th>
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(0) }}</th>
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(1) }}</th>
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(2) }}</th>
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(3) }}</th>
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(4) }}</th>
                    <th width="14.2%">{{ 'DAYS_OF_THE_WEEK'|ta(5) }}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                {% set startDow = calendar.date|date('F 1\\s\\t Y')|date('w') %}
                {% set dow = startDow %}
                {% set month = "now"|date("F") %}
                {% for day in range(1,calendar.daysInMonth) %}
                    {% if loop.first and startDow != 0 %}
                        <td colspan="{{ startDow }}"></td>
                    {% endif %}
                    <td {% if (day == calendar.currentDay) and (month == calendar.date|date("F")) %}class="current"{% endif %}>
                        <div class="events">
                            {% if calendar.events[calendar.year][calendar.month][day] != null %}
    							{% set title_date = calendar.month ~ '/' ~ day ~ '/' ~ calendar.year %}
    							<div class="day">
                                    <a class="calendar-day-link open-calendar-modal" href="#!" title="{{ title_date|date('l, F j, Y') }}">
                                        {{ day }}
                                    </a>
                                </div>
    						{% else %}
    							<div class="day">
                                    <span>{{ day }}</span>
                                </div>
                            {% endif %}
                        </div>
                    </td>
                    {% if loop.last and dow != 6 %}
                        <td colspan="{{ 6 - dow }}">&nbsp;</td>
                    {% endif %}
                    {% if dow == 6 %}
                        {% set dow = 0 %}
                    </tr>
                    <tr>
                    {% else %}
                        {% set dow = dow + 1 %}
                    {% endif %}
                {% endfor %}
                </tr>
            </tbody>
        </table>

    </section>

    <section class="calendar-details">

        {% for day in range(1,calendar.daysInMonth) %}
            
            {% if calendar.events[calendar.year][calendar.month][day] != null %}
                <div class="calendar-day-details {% if (day == calendar.currentDay) and (month == calendar.date|date("F")) %}active{% endif %}">
                    {% set title_date = calendar.month ~ '/' ~ day ~ '/' ~ calendar.year %}
                    <h4 class="day">{{ title_date|date('l, F j') }}</h4>

                    <ul>
                        {% for events in calendar.events[calendar.year][calendar.month][day] %}
                            {% for event in events %}
                                {% if event.title %}
                                    <li class="event">
                                        <span class="event-title">
                                            <a href="{{ event.url }}" class="p-name u-url">
                                                <time class="dt-start" datetime="{{ event.event.start|date("c") }}">{{ event.event.start|date("g:ia") }}</time>
                                                <span>{{ event.title }}</span>
                                            </a>
                                        </span>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </ul>

                </div>
            {% endif %}

        {% endfor %}

    </section>

</div><!--.calendar-container-->

{% endblock %}
